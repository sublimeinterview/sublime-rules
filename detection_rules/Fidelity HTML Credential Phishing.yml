source: |-
  type.inbound

  // 1) Attachment is HTML
  and any(attachments,
    .file_extension in~ ('htm', 'html') or .file_type == "html"
  )

  // 2) Sender is NOT a Fidelity-related domain
  and sender.email.domain.root_domain not in (
    "fidelity.com",
    "netbenefits.com"
  )

  // 3) Body contains login or account-access language
  and (
    regex.icontains(body.current_thread.text, "log[ -]?in")
    or regex.icontains(body.current_thread.text, "sign[ -]?in")
    or strings.icontains(body.current_thread.text, "account access")
    or strings.icontains(body.current_thread.text, "verify your account")
    or strings.icontains(body.current_thread.text, "suspicious activity")
  )
type: rule
name: Fidelity HTML Credential Phishing
authors:
- name: Matthew Pascual-Mead
description: 'This email scans for content from Fidelity that may be used as a way
  of phishing for a recipient Fidelity log-in. The rule analyzes for HTML attachments,
  incorrect email domain, and body content used for credential attacks. '
references: []
tags:
- Credential Phishing
- Suspicious HTML Attachment
- Brand Impersonation
severity: critical
